# E2E тесты

Интеграционные (E2E) тесты для проверки полного flow работы API через HTTP запросы.

## Требования

- PostgreSQL должен быть запущен
- Тестовая база данных `pr_reviewer_test` должна быть создана
- Миграции должны быть применены к тестовой БД

## Настройка

### Создание тестовой БД

```bash
# Через psql
psql -U postgres -c "CREATE DATABASE pr_reviewer_test;"

# Или через Makefile
make test-db-create
```

### Настройка переменных окружения

По умолчанию тесты используют:
```
TEST_DATABASE_URL=postgres://postgres:postgres@localhost:5432/pr_reviewer_test?sslmode=disable
```

Можно переопределить через переменную окружения:
```bash
export TEST_DATABASE_URL="postgres://user:password@host:port/dbname?sslmode=disable"
```

## Запуск тестов

```bash
# Запуск всех E2E тестов
make test-e2e

# Или напрямую через go test
go test -v ./test/e2e/... -timeout 30s
```

## Что тестируется

- ✅ Создание пользователей
- ✅ Получение пользователя по ID
- ✅ Создание команд
- ✅ Добавление участников в команды
- ✅ Создание PR с автоматическим назначением ревьюверов
- ✅ Переназначение ревьюверов
- ✅ Merge PR
- ✅ Запрет переназначения после merge
- ✅ Массовая деактивация команды
- ✅ Получение статистики

## Структура тестов

Каждый тест:
1. Настраивает тестовый HTTP сервер с реальной БД
2. Применяет миграции
3. Выполняет тестовые сценарии через HTTP API
4. Очищает тестовые данные после завершения

## Примечания

- Тесты используют реальную PostgreSQL БД (не in-memory)
- После каждого теста данные очищаются
- Тесты изолированы друг от друга
- Таймаут выполнения: 30 секунд

